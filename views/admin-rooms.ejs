<%- include('partials/header') %>

<div class="container my-4">
  <ul class="nav nav-pills mb-3">
    <li class="nav-item"><a class="nav-link" href="/admin/dashboard">Tổng quan</a></li>
    <li class="nav-item"><a class="nav-link active" href="/admin/rooms">Phòng</a></li>
    <li class="nav-item"><a class="nav-link" href="/admin/bookings">Đơn đặt</a></li>
    <li class="nav-item"><a class="nav-link" href="/admin/users">Khách hàng</a></li>
    <li class="nav-item"><a class="nav-link" href="/admin/discounts">Mã giảm giá</a></li>
  </ul>

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="mb-0">Quản lý phòng</h4>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addRoom">+ Thêm phòng</button>
  </div>

  <div class="card p-3 border-0 shadow-sm rounded-4">
    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
        <tr>
          <th>#</th><th>Số phòng</th><th>Loại</th><th>Giá/đêm</th><th>Trạng thái</th><th>Địa điểm</th><th>Ảnh</th><th></th>
        </tr>
        </thead>
        <tbody>
        <% rooms.forEach((r, idx) => { %>
          <tr>
            <td><%= idx+1 %></td>
            <td><%= r.roomNumber %></td>
            <td><%= r.type %></td>
            <td><%= Number(r.price||0).toLocaleString('vi-VN') %></td>
            <td><span class="badge bg-<%= r.status==='available'?'success':'secondary' %>"><%= r.status %></span></td>
            <td><%= r.location || '' %></td>
            <td>
              <% if(r.image){ %>
              <img src="<%= r.image %>" alt="" style="width:64px;height:48px;object-fit:cover;border-radius:8px">
              <% } %>
            </td>
            <td class="text-end">
              <button class="btn btn-sm btn-outline-primary"
                      data-bs-toggle="modal" data-bs-target="#edit-<%= r._id %>">Sửa</button>
              <form action="/admin/rooms/<%= r._id %>/delete" method="post" class="d-inline"
                    onsubmit="return confirm('Xoá phòng này?')">
                <button class="btn btn-sm btn-outline-danger">Xoá</button>
              </form>
            </td>
          </tr>

          <!-- Modal Edit -->
          <div class="modal fade" id="edit-<%= r._id %>" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
              <form class="modal-content" action="/admin/rooms/<%= r._id %>" method="post">
                <div class="modal-header"><h5 class="modal-title">Sửa phòng</h5>
                  <button class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body row g-2">
                  <div class="col-6">
                    <label class="form-label">Số phòng</label>
                    <input name="roomNumber" class="form-control" value="<%= r.roomNumber %>" required>
                  </div>
                  <div class="col-6">
                    <label class="form-label">Loại</label>
                    <select name="type" class="form-select">
                      <option <%= r.type==='Standard'?'selected':'' %>>Standard</option>
                      <option <%= r.type==='Superior'?'selected':'' %>>Superior</option>
                      <option <%= r.type==='Deluxe'?'selected':'' %>>Deluxe</option>
                      <option <%= r.type==='Suite'?'selected':'' %>>Suite</option>
                    </select>
                  </div>
                  <div class="col-6">
                    <label class="form-label">Giá/đêm</label>
                    <input name="price" type="number" min="0" class="form-control" value="<%= r.price %>" required>
                  </div>
                  <div class="col-6">
                    <label class="form-label">Trạng thái</label>
                    <select name="status" class="form-select">
                      <option value="available" <%= r.status==='available'?'selected':'' %>>available</option>
                      <option value="booked" <%= r.status==='booked'?'selected':'' %>>booked</option>
                      <option value="maintain" <%= r.status==='maintain'?'selected':'' %>>maintain</option>
                    </select>
                  </div>
                  <div class="col-6">
                    <label class="form-label">Địa điểm</label>
                    <input name="location" class="form-control" value="<%= r.location||'' %>">
                  </div>
                  <div class="col-6">
                    <label class="form-label">Ảnh (URL)</label>
                    <input name="image" class="form-control" value="<%= r.image||'' %>">
                  </div>
                </div>
                <div class="modal-footer">
                  <button class="btn btn-secondary" data-bs-dismiss="modal">Huỷ</button>
                  <button class="btn btn-primary">Lưu</button>
                </div>
              </form>
            </div>
          </div>
        <% }) %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Modal Add -->
<div class="modal fade" id="addRoom" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <form class="modal-content" action="/admin/rooms" method="post">
      <div class="modal-header"><h5 class="modal-title">Thêm phòng</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body row g-2">
        <div class="col-6">
          <label class="form-label">Số phòng</label>
          <input name="roomNumber" class="form-control" required>
        </div>
        <div class="col-6">
          <label class="form-label">Loại</label>
          <select name="type" class="form-select">
            <option>Standard</option><option>Superior</option>
            <option selected>Deluxe</option><option>Suite</option>
          </select>
        </div>
        <div class="col-6">
          <label class="form-label">Giá/đêm</label>
          <input name="price" type="number" min="0" class="form-control" required>
        </div>
        <div class="col-6">
          <label class="form-label">Trạng thái</label>
          <select name="status" class="form-select">
            <option value="available" selected>available</option>
            <option value="booked">booked</option>
            <option value="maintain">maintain</option>
          </select>
        </div>
        <div class="col-6">
          <label class="form-label">Địa điểm</label>
          <input name="location" class="form-control">
        </div>
        <div class="col-6">
          <label class="form-label">Ảnh (URL)</label>
          <input name="image" class="form-control">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Huỷ</button>
        <button class="btn btn-primary">Thêm</button>
      </div>
    </form>
  </div>
</div>

<%- include('partials/footer') %>
